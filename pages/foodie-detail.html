<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <title>吃貨專區-內頁</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  </head>
  <body>
    <div class="phone">
      <div class="screen">
        <main class="main main-mb header-bar-mt">
          <!-- 找飯友 -->

          <section class="header-bar">
            <%- include('./layout/header'); -%>
            <section class="d-flex align-items-center py-2 mx-2 mb-4">
              <a class="ai-topbar-item" href="index.html"
                ><img
                  src="../assets/images/icon/arrow-left.svg"
                  alt="arrow-left.svg"
              /></a>

              <span class="t1b me-auto"></span>

              <a class="ai-topbar-item" href="#">
                <img
                  class="bookmark-btn"
                  src="../assets/images/icon/collect-btn-navbar.svg"
                  alt="bookmark_default.svg"
                />
              </a>
              <a class="ai-topbar-item" href="#">
                <span class="material-symbols-outlined">ios_share</span>
              </a>
            </section>
          </section>

          <!-- 文章標題 & 作者資訊 -->
          <div class="container">
            <div class="mb-3">
              <h2 class="t1b text-t500">隱藏版甜點天堂！肉桂捲令人懷念</h2>
              <div class="d-flex align-items-center text-muted small mt-2">
                <img
                  src="../assets/images/聊天頭貼.svg"
                  alt="作者頭像"
                  class="rounded-circle me-2"
                  width="36"
                  height="36"
                />
                <div class="d-flex flex-column">
                  <span class="me-2 text-n500 t3">Ken</span>
                  <span class="t4 text-n300">昨天00:13</span>
                </div>
              </div>
            </div>

            <!-- 貼文圖片 -->
            <div class="mb-3">
              <img
                src="../assets/images/foodie-detail/貼文照片.svg"
                alt="肉桂捲"
                class="img-fluid rounded-3 w-100"
              />
            </div>

            <!-- 店家資訊 -->
            <div class="mb-3">
              <p class="mb-1">
                <span class="text-n300 t2b">店家名稱</span>
                <span class="text-n500 t2">捲捲日常</span>

                <span>
                  <img
                    class="location"
                    src="../assets/images/icon/location.svg"
                  />
                </span>

                <span class="text-n300 t2">中山區</span>
              </p>
              <div class="d-flex align-items-center">
                <span class="me-2 text-n300 t2b">推薦指數</span>
                <!-- 星星評分 -->
                <div class="d-flex align-items-center gap-1 star-rating">
                  <img
                    src="../assets/images/icon/mingcute_star-fill.svg"
                    alt=""
                    width="16"
                    height="16"
                  />
                  <img
                    src="../assets/images/icon/mingcute_star-line.svg"
                    alt=""
                    width="16"
                    height="16"
                  />
                  <img
                    src="../assets/images/icon/mingcute_star-line.svg"
                    alt=""
                    width="16"
                    height="16"
                  />
                  <img
                    src="../assets/images/icon/mingcute_star-line.svg"
                    alt=""
                    width="16"
                    height="16"
                  />
                  <img
                    src="../assets/images/icon/mingcute_star-line.svg"
                    alt=""
                    width="16"
                    height="16"
                  />
                </div>
              </div>
            </div>

            <!-- 文章內容 -->
            <div class="mb-4 t2 text-n500">
              <p>
                不是開玩笑，這家的肉桂捲一打開就香到讓人忘記煩惱。
                <br />
                肉桂＋焦糖＋奶油的融合真的太犯規，<br />
                溫熱的時候外酥內軟，還有一點點牽絲～吃完真的<br />
                會想直接再買一顆回家！<br />
                適合搭配一杯黑咖啡或熱牛奶，<br />是那種吃了會笑出來的甜點，<br />讓人瞬間進入冬季戀愛感🧣☕️
              </p>
            </div>
            <hr class="yellow_line" />
            <!-- 互動數據區塊 -->
            <section
              class="d-flex align-items-center justify-content-between pt-3 pb-2 mb-3"
            >
              <!-- emoji + 數字 -->
              <div class="d-flex align-items-center">
                <span class="me-2">
                  <img
                    src="../assets/images/icon/Metrics.svg"
                    alt="Metrics.svg"
                  />
                </span>

                <span class="me-3">1565</span>
                <span class="me-2">
                  <img
                    src="../assets/images/icon/Messages.svg"
                    alt="Messages.svg"
                  />
                </span>

                <span class="me-3">123</span>
              </div>
            </section>

            <!-- 留言區 -->
            <div class="mb-4">
              <h2 class="t2b mb-2 text-t500">全部留言</h2>
              <!-- 標籤列 -->
              <!-- <div class="d-flex align-items-center mb-3 border-bottom pb-2">
                <button class="btn btn-sm btn-outline-secondary border me-2">
                  最新留言
                </button>
                <button class="btn btn-sm btn-outline-secondary">熱門</button>
              </div> -->

              <div class="d-flex text-n500 t2 align-items-center mb-3 pb-2">
                <button class="comment-tab-btn active me-2">最新留言</button>
                <button class="comment-tab-btn">熱門</button>
              </div>

              <!-- 單則留言 -->
              <div class="d-flex align-items-start mb-3">
                <img
                  src="../assets/images/foodie-detail/留言-01.svg"
                  alt="頭像"
                  class="rounded-circle me-2"
                />
                <div class="flex-grow-1">
                  <div class="d-flex justify-content-between">
                    <div class="d-flex flex-column">
                      <span class="text-n300 t5">米奇</span>
                      <span class="t4 text-n300">今天09:30</span>
                    </div>

                    <!-- <a href="#" class="text-muted small">
                      <span class="material-symbols-outlined align-middle"
                        >favorite</span
                      >
                    </a> -->
                    <div
                      class="feedback-group chat-mb-lg d-flex align-items-center gap-1"
                    >
                      <img
                        class="feedback-active"
                        src="../assets/images/icon/feedback_active.svg"
                        alt="feedback_active.svg"
                      />
                      <img
                        class="feedback-default"
                        src="../assets/images/icon/feedback_default.svg"
                        alt="feedback_default.svg"
                        style="display: none"
                      />
                    </div>
                  </div>
                  <p class="mb-1 t3 text-muted text-n500">
                    上次路過這間甜點店被吸進來，下一次也想吃看看耶，有沒有其他人想一起？
                  </p>
                </div>
              </div>

              <div class="d-flex align-items-start mb-3">
                <img
                  src="../assets/images/foodie-detail/留言-02.svg"
                  alt="頭像"
                  class="rounded-circle me-2"
                />
                <div class="flex-grow-1">
                  <div class="d-flex justify-content-between">
                    <div class="d-flex flex-column">
                      <span class="t5 text-n300">古老神秘的傳說</span>
                      <span class="t4 text-n300"> 今天09:25 </span>
                    </div>

                    <div
                      class="feedback-group chat-mb-lg d-flex align-items-center gap-1"
                    >
                      <img
                        class="feedback-active"
                        src="../assets/images/icon/feedback_active.svg"
                        alt="feedback_active.svg"
                        style="display: none"
                      />
                      <img
                        class="feedback-default"
                        src="../assets/images/icon/feedback_default.svg"
                        alt="feedback_default.svg"
                      />
                    </div>
                  </div>
                  <p class="mb-1 t3 text-muted text-n500">好想推薦給朋友～</p>
                </div>
              </div>
            </div>
          </div>

          <!-- 新增按鈕 -->
          <div class="fixed-rightdown">
            <a href="#" class="add">
              <span class="material-symbols-outlined text-p400">add</span>
            </a>
          </div>
        </main>

        <footer class="footer-ai rounded-top-3">
          <div class="footer-ai-container">
            <div class="d-flex align-items-center gap-2">
              <img
                src="../assets/images/icon/Head sticker.svg"
                alt="sticker.svg"
                width="36"
                height="36"
              />
              <div class="w-100 d-flex align-items-center">
                <input
                  id="aiInput"
                  type="text"
                  class="t1 col text-white bg-transparent border-0"
                  placeholder="留言....."
                />
                <img
                  id="default_statusBtn"
                  class="favrite"
                  src="../assets/images/icon/status=white.svg"
                  alt="favrite"
                />
                <img
                  id="active_statusBtn"
                  class="favrite"
                  src="../assets/images/icon/feedback_active.svg"
                  alt="feedback_active"
                />
                <img
                  id="sendBtn"
                  class="favrite"
                  src="../assets/images/icon/send.svg"
                  alt="send.svg"
                  style="display: none"
                />
              </div>
            </div>
          </div>
          <div class="light-bar-container">
            <div class="light-bar"></div>
          </div>
        </footer>
      </div>
    </div>

    <script type="module" src="../main.js"></script>
    <script>
      $(function () {
        // feedback-group 單一 click 用 toggle 切換兩張圖
        $(".feedback-group").on("click", function () {
          $(this).find(".feedback-active, .feedback-default").toggle();
        });

        // 星星評分
        const starImgs = document.querySelectorAll(
          ".d-flex.align-items-center .star-rating img"
        );
        starImgs.forEach((star, idx) => {
          star.addEventListener("click", function () {
            starImgs.forEach((s, i) => {
              s.src =
                i <= idx
                  ? "../assets/images/icon/mingcute_star-fill.svg"
                  : "../assets/images/icon/mingcute_star-line.svg";
            });
          });
        });

        // footer 輸入欄位與按鈕切換（互斥處理）
        const $input = $("#aiInput");
        const $defaultStatus = $("#default_statusBtn");
        const $activeStatus = $("#active_statusBtn");
        const $send = $("#sendBtn");

        // 狀態變數：是否已按愛心（收藏/按讚）
        let isFavorited = false;

        function renderFooterIcons() {
          const hasText = $.trim($input.val()).length > 0;

          // 有文字時只顯示 send（其他狀態隱藏）
          if (hasText) {
            $send.show();
            $defaultStatus.hide();
            $activeStatus.hide();
            return;
          }

          // 無文字時，依 isFavorited 顯示其中一個 icon（確保不會同時顯示）
          $send.hide();
          if (isFavorited) {
            $activeStatus.show();
            $defaultStatus.hide();
          } else {
            $defaultStatus.show();
            $activeStatus.hide();
          }
        }

        // 初始顯示設定（確保兩個愛心不會同時顯示）
        isFavorited = false; // 預設未按愛心
        renderFooterIcons();

        // 輸入監聽：動態顯示 send 或狀態圖示
        $input.on("input", function () {
          renderFooterIcons();
        });

        // 點擊 status 圖示互相切換（改變狀態變數並重新 render）
        $defaultStatus.on("click", function () {
          // 只有在沒有輸入文字時才處理
          if ($.trim($input.val()).length === 0) {
            isFavorited = true;
            renderFooterIcons();
          }
        });
        $activeStatus.on("click", function () {
          if ($.trim($input.val()).length === 0) {
            isFavorited = false;
            renderFooterIcons();
          }
        });

        // send 按鈕行為：送出、清空並還原
        $send.on("click", function () {
          const val = $.trim($input.val());
          if (!val) return;
          // 範例：用 alert 或 toast 顯示成功
          alert("已送出留言：" + val);
          $input.val("");
          renderFooterIcons();
        });
      });
    </script>
  </body>
</html>
